<!DOCTYPE html>
<html>
  <title>Dynamic Asteroids</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <script src="js/lib/animatic.js"></script>
  <script src="js/spaceship.js"></script>
  <script src="js/asteroid.js"></script>
  <script src="js/explosion.js"></script>
  <script src="js/projectile.js"></script>
  <script>
    var canvas; 
    var spaceship; 
    var asteroidSprite;
    var asteroids = []; 
    var projectiles = []
    var explosions = [];

    function repaintAll(context, arr) {
      for (var i = 0; i < arr.length; i++){
        context.save();
        arr[i].paint(context);
        context.restore();
      }
    }

    function update(){
      try {
        var context = canvas.getContext('2d');
        context.fillStyle = "rgb(0,0,0)";
        context.fillRect(0, 0, canvas.width, canvas.height);
        context.save();
        spaceship.paint(context);
        context.restore();
        repaintAll(context, asteroids);
        repaintAll(context, projectiles);
        repaintAll(context, explosions);
      } catch(ex) {
        alert(ex);
      }
    }

    function repaintLoop(){
      update();
      setTimeout("repaintLoop()", 30);
    }

    function init(){
      canvas = document.getElementById("asteroids-game");
      asteroidSprite = document.getElementById("asteroid-sprite");
      spaceship = new Spaceship();
      for(var i = 0; i < 10; i++){
        asteroids[i] = new Asteroid();
      }
      repaintLoop();
    }

    function keyDown(event){
      switch (event.keyCode){
        case 37: // LEFT
          spaceship.turnLeft();
          break;
        case 38: // UP
          spaceship.speedUp();
          break;
        case 39: // RIRGHT
          spaceship.turnRight();
          break;
        case 40: // DOWN
          spaceship.slowDown();
          break;
        case 32:
          projectiles.push(new Projectile(spaceship.x, spaceship.y, spaceship.heading));
          break;
        default:
          // nothing
      }
      return false;
    }

    window.onload = init;
    window.onkeydown = keyDown;
  </script>
  <body>
    <img src="img/asteroid.png" id="asteroid-sprite" style="display: none"/>
    <canvas id="asteroids-game" width="800" height="600">
      Sorry, your browser does not support the canvas element. 
      Upgrade to a modern browser
    <canvas>
  </body>
</html>

